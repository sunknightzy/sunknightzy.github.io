{"title":"Docker搭建RocketMQ","uid":"9169b2fd1415ecd8979f95e711397f88","slug":"Docker搭建RocketMQ","date":"2021-10-04T07:13:11.000Z","updated":"2023-10-05T13:49:36.000Z","comments":true,"path":"api/articles/Docker搭建RocketMQ.json","keywords":null,"cover":"https://raw.githubusercontent.com/sunknightzy/picsee/main/Picsee/abnerworks.Typora/docker-S6yOMW.png","content":"<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>博客是基于 RocketMQ 4.X 版本，现在又出了 5.X 版本</p>\n<p>RocketMQ 4.X 和 5.X 版本之间有很大的区别，需要谨慎升级 5.X，升级之前要去看看 <a target=\"_blank\" rel=\"noopener\" href=\"https://rocketmq.apache.org/zh/docs/domainModel/02topic#%E8%A1%8C%E4%B8%BA%E7%BA%A6%E6%9D%9F\">5.X 官方文档</a>  </p>\n<ol>\n<li>5.X 版本主题需要绑定消息类型 <a target=\"_blank\" rel=\"noopener\" href=\"https://rocketmq.apache.org/zh/docs/domainModel/02topic#%E8%A1%8C%E4%B8%BA%E7%BA%A6%E6%9D%9F\">链接</a>  </li>\n<li>5.X 版本队列名称改变 <a target=\"_blank\" rel=\"noopener\" href=\"https://rocketmq.apache.org/zh/docs/domainModel/03messagequeue#%E7%89%88%E6%9C%AC%E5%85%BC%E5%AE%B9%E6%80%A7\">链接</a></li>\n<li>5.X 版本消息具有不可变性 <a target=\"_blank\" rel=\"noopener\" href=\"https://rocketmq.apache.org/zh/docs/domainModel/04message#%E4%BD%BF%E7%94%A8%E5%BB%BA%E8%AE%AE\">链接</a></li>\n<li>5.X 版本不再需要生产者组 <a target=\"_blank\" rel=\"noopener\" href=\"https://rocketmq.apache.org/zh/docs/domainModel/04producer#%E7%89%88%E6%9C%AC%E5%85%BC%E5%AE%B9%E6%80%A7\">链接</a></li>\n<li>5.X 版本消费者组兼容性 <a target=\"_blank\" rel=\"noopener\" href=\"https://rocketmq.apache.org/zh/docs/domainModel/07consumergroup#%E7%89%88%E6%9C%AC%E5%85%BC%E5%AE%B9%E6%80%A7\">链接</a></li>\n<li>5.X 版本消费者兼容性 <a target=\"_blank\" rel=\"noopener\" href=\"https://rocketmq.apache.org/zh/docs/domainModel/08consumer#%E7%89%88%E6%9C%AC%E5%85%BC%E5%AE%B9%E6%80%A7\">链接</a></li>\n<li>5.X 版本的 SDK 中删除了消息查询的接口</li>\n</ol>\n<p>从概念上来看，其实 5.X 版本是更加规范的，SDK 更加轻量化；不过 SDK 删除了消息查询接口十分让人抓狂，消息发送超时了无法回查，只能重试，消费端必须要搞消息去重和幂等</p></blockquote>\n<h2 id=\"镜像拉取\"><a href=\"#镜像拉取\" class=\"headerlink\" title=\"镜像拉取\"></a>镜像拉取</h2><p>RocketMQ 镜像</p>\n<div class=\"language-bash\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">bash</span><pre class=\"shiki material-theme\" style=\"background-color: #263238\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">docker</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C3E88D\">pull</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C3E88D\">apache/rocketmq:4.9.6</span></span></code></pre></div><p>RocketMQ Dashboard 镜像</p>\n<p><a target=\"_blank\" rel=\"noopener\" href=\"https://github.com/apache/rocketmq-dashboard\">Github地址</a></p>\n<div class=\"language-bash\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">bash</span><pre class=\"shiki material-theme\" style=\"background-color: #263238\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">docker</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C3E88D\">pull</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C3E88D\">apacherocketmq/rocketmq-dashboard:2.0.1</span></span></code></pre></div><h2 id=\"创建容器共享网络\"><a href=\"#创建容器共享网络\" class=\"headerlink\" title=\"创建容器共享网络\"></a>创建容器共享网络</h2><p>RocketMQ中有多个服务，需要创建多个容器，创建 docker 网络便于容器间相互通信</p>\n<div class=\"language-bash\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">bash</span><pre class=\"shiki material-theme\" style=\"background-color: #263238\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">docker</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C3E88D\">network</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C3E88D\">create</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C3E88D\">rocketmq</span></span></code></pre></div><h2 id=\"启动-NameServer\"><a href=\"#启动-NameServer\" class=\"headerlink\" title=\"启动 NameServer\"></a>启动 NameServer</h2><p>在本机创建NameServer目录</p>\n<div class=\"language-bash\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">bash</span><pre class=\"shiki material-theme\" style=\"background-color: #263238\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">mkdir</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C3E88D\">-p</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C3E88D\">/Users/oak/docker/rocketmq/namesrv/logs</span></span></code></pre></div><p>启动 Nameserver</p>\n<div class=\"language-bash\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">bash</span><pre class=\"shiki material-theme\" style=\"background-color: #263238\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">docker</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C3E88D\">run</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C3E88D\">-d</span><span style=\"color: #EEFFFF\"> \\</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">--name </span><span style=\"color: #C3E88D\">rmqnamesrv</span><span style=\"color: #EEFFFF\"> \\</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">--net </span><span style=\"color: #C3E88D\">rocketmq</span><span style=\"color: #EEFFFF\"> \\</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">-p </span><span style=\"color: #F78C6C\">9876</span><span style=\"color: #C3E88D\">:9876</span><span style=\"color: #EEFFFF\"> \\</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">-v </span><span style=\"color: #C3E88D\">/Users/oak/docker/rocketmq/namesrv/logs:/home/rocketmq/logs</span><span style=\"color: #EEFFFF\"> \\</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">-e </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">JAVA_OPT_EXT=-Xms512M -Xmx512M -Xmn128m</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #EEFFFF\"> \\</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">-e </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">MAX_POSSIBLE_HEAP=100000000</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #EEFFFF\"> \\</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">apache/rocketmq:4.9.6 </span><span style=\"color: #C3E88D\">sh</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C3E88D\">mqnamesrv</span></span></code></pre></div><p>验证 NameServer 是否启动成功</p>\n<div class=\"language-txt\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">txt</span><pre class=\"shiki material-theme\" style=\"background-color: #263238\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #EEFFFF\">docker logs -f rmqnamesrv</span></span></code></pre></div><p>看到 ‘The Name Server boot success..’, 表示 NameServer 已成功启动</p>\n<h2 id=\"启动-Broker\"><a href=\"#启动-Broker\" class=\"headerlink\" title=\"启动 Broker\"></a>启动 Broker</h2><p>在本机创建 Broker 目录</p>\n<div class=\"language-bash\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">bash</span><pre class=\"shiki material-theme\" style=\"background-color: #263238\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">mkdir</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C3E88D\">-p</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C3E88D\">/Users/oak/docker/rocketmq/broker/logs</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C3E88D\">/Users/oak/docker/rocketmq/broker/store</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C3E88D\">/Users/oak/docker/rocketmq/broker/conf</span></span></code></pre></div><p>再本机 broker 的 conf目录下配置文件 broker.conf</p>\n<div class=\"language-properties\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">properties</span><pre class=\"shiki material-theme\" style=\"background-color: #263238\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #F07178\">brokerClusterName</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #EEFFFF\"> DefaultCluster</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">brokerName</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #EEFFFF\"> broker-a</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">brokerId</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #EEFFFF\"> 0</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">deleteWhen</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #EEFFFF\"> 04</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">fileReservedTime</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #EEFFFF\"> 48</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">brokerRole</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #EEFFFF\"> ASYNC_MASTER</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">flushDiskType</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #EEFFFF\"> ASYNC_FLUSH</span></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\"># 这里设置为宿主机的 IP </span></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\"># 如果不需要 Dashboard，设置为 127.0.0.1 也行</span></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\"># 如果要 Dashboard 就要设置为宿主机 IP，不过宿主机IP变了，这里也要一起改变</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">brokerIP1</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #EEFFFF\"> 192.168.1.xxx</span></span></code></pre></div><p>NameServer 成功启动后，再启动 Broker</p>\n<p><strong>MAX_POSSIBLE_HEAP</strong> 参数设置 Broker 服务的最大堆内存，如果太小启动会失败</p>\n<div class=\"language-bash\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">bash</span><pre class=\"shiki material-theme\" style=\"background-color: #263238\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">docker</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C3E88D\">run</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C3E88D\">-d</span><span style=\"color: #EEFFFF\"> \\</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">--name </span><span style=\"color: #C3E88D\">rmqbroker</span><span style=\"color: #EEFFFF\"> \\</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">--net </span><span style=\"color: #C3E88D\">rocketmq</span><span style=\"color: #EEFFFF\"> \\</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">-p </span><span style=\"color: #F78C6C\">10912</span><span style=\"color: #C3E88D\">:10912</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C3E88D\">-p</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #F78C6C\">10911</span><span style=\"color: #C3E88D\">:10911</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C3E88D\">-p</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #F78C6C\">10909</span><span style=\"color: #C3E88D\">:10909</span><span style=\"color: #EEFFFF\"> \\</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">-v  </span><span style=\"color: #C3E88D\">/Users/oak/docker/rocketmq/broker/logs:/home/rocketmq/logs</span><span style=\"color: #EEFFFF\"> \\</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">-v  </span><span style=\"color: #C3E88D\">/Users/oak/docker/rocketmq/broker/store:/home/rocketmq/store</span><span style=\"color: #EEFFFF\"> \\</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">-v  </span><span style=\"color: #C3E88D\">/Users/oak/docker/rocketmq/broker/conf/broker.conf:/home/rocketmq/rocketmq-4.9.6/conf/broker.conf</span><span style=\"color: #EEFFFF\"> \\</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">-e </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">JAVA_OPT_EXT=-Xms1024M -Xmx1024M -Xmn128m</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #EEFFFF\"> \\</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">-e </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">MAX_POSSIBLE_HEAP=200000000</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #EEFFFF\"> \\</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">-e </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">NAMESRV_ADDR=rmqnamesrv:9876</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #EEFFFF\"> \\</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">apache/rocketmq:4.9.6 </span><span style=\"color: #C3E88D\">sh</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C3E88D\">mqbroker</span><span style=\"color: #EEFFFF\"> \\</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">-c </span><span style=\"color: #C3E88D\">/home/rocketmq/rocketmq-4.9.6/conf/broker.conf</span></span></code></pre></div><p>验证 Broker 是否启动成功</p>\n<div class=\"language-bash\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">bash</span><pre class=\"shiki material-theme\" style=\"background-color: #263238\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">docker</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C3E88D\">logs</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C3E88D\">rmqbroker</span></span></code></pre></div><p>看到 ‘The broker boot success..’, 表示 Broker 已成功启动</p>\n<h2 id=\"启动-Dashboard\"><a href=\"#启动-Dashboard\" class=\"headerlink\" title=\"启动 Dashboard\"></a>启动 Dashboard</h2><div class=\"language-bash\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">bash</span><pre class=\"shiki material-theme\" style=\"background-color: #263238\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">docker</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C3E88D\">run</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C3E88D\">-d</span><span style=\"color: #EEFFFF\"> \\</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">--name </span><span style=\"color: #C3E88D\">rmqdashboard</span><span style=\"color: #EEFFFF\"> \\</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">--net </span><span style=\"color: #C3E88D\">rocketmq</span><span style=\"color: #EEFFFF\"> \\</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">-e </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">JAVA_OPTS=-Drocketmq.namesrv.addr=rmqnamesrv:9876 -Dserver.port=8080 -Dcom.rocketmq.sendMessageWithVIPChannel=false</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #EEFFFF\"> \\</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">-p </span><span style=\"color: #F78C6C\">18080</span><span style=\"color: #C3E88D\">:8080</span><span style=\"color: #EEFFFF\"> \\</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">-t </span><span style=\"color: #C3E88D\">apacherocketmq/rocketmq-dashboard:2.0.1</span></span></code></pre></div><p>验证 Dashboard 是否启动成功，直接访问 <a target=\"_blank\" rel=\"noopener\" href=\"http://localhost:18080/\">Dashboard</a> </p>\n<p>Dashboard是支持 4.X 和 5.X 版本的, 可以在界面上切换版本，参考<a target=\"_blank\" rel=\"noopener\" href=\"https://github.com/apache/rocketmq-dashboard/blob/master/docs/1_0_0/UserGuide_CN.md\">官方使用文档</a></p>\n<p><img src=\"https://raw.githubusercontent.com/sunknightzy/picsee/main/Picsee/typora-user-images/image-20250603212137435-LTUuqk.png\"></p>\n<h2 id=\"Broker-配置详解\"><a href=\"#Broker-配置详解\" class=\"headerlink\" title=\"Broker 配置详解\"></a>Broker 配置详解</h2><details class=\"custom-details\">\n<summary> 展开查看broker.conf</summary>\n<p><div class=\"language-properties\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">properties</span><pre class=\"shiki material-theme\" style=\"background-color: #263238\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#所属集群名字</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">brokerClusterName</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #EEFFFF\">DefaultCluster</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#broker名字，注意此处不同的配置文件填写的不一样，如果在broker-a.properties使用:broker-a,</span></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#在broker-b.properties使用:broker-b</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">brokerName</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #EEFFFF\">broker-a</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#0 表示Master，&gt;0 表示Slave</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">brokerId</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #EEFFFF\">0</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#nameServer地址，分号分割</span></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#namesrvAddr=rocketmq-nameserver1:9876;rocketmq-nameserver2:9876</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">namesrvAddr</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #EEFFFF\">172.168.1.xxx:9876</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#启动IP,如果 docker 报 com.alibaba.rocketmq.remoting.exception.RemotingConnectException: connect to &lt;192.168.0.120:10909&gt; failed</span></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\"># 解决方式1 加上一句producer.setVipChannelEnabled(false);</span></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\"># 解决方式2 brokerIP1 设置宿主机IP，不要使用docker 内部IP</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">brokerIP1</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #EEFFFF\">127.0.0.1</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#在发送消息时，自动创建服务器不存在的topic，默认创建的队列数</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">defaultTopicQueueNums</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #EEFFFF\">4</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#是否允许 Broker 自动创建Topic，建议线下开启，线上关闭 ！！！</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">autoCreateTopicEnable</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #EEFFFF\">true</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#是否允许 Broker 自动创建订阅组，建议线下开启，线上关闭</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">autoCreateSubscriptionGroup</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #EEFFFF\">true</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#此参数控制是否开启密码</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">aclEnable</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #EEFFFF\">false</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#Broker 对外服务的监听端口</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">listenPort</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #EEFFFF\">10911</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#删除文件时间点，默认凌晨4点</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">deleteWhen</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #EEFFFF\">04</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#文件保留时间，默认48小时</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">fileReservedTime</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #EEFFFF\">120</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#commitLog每个文件的大小默认1G</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">mapedFileSizeCommitLog</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #EEFFFF\">1073741824</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#ConsumeQueue每个文件默认存30W条，根据业务情况调整</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">mapedFileSizeConsumeQueue</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #EEFFFF\">300000</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#destroyMapedFileIntervalForcibly=120000</span></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#redeleteHangedFileInterval=120000</span></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#检测物理文件磁盘空间</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">diskMaxUsedSpaceRatio</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #EEFFFF\">88</span></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#存储路径</span></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#storePathRootDir=/home/ztztdata/rocketmq-all-4.1.0-incubating/store</span></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#commitLog 存储路径</span></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#storePathCommitLog=/home/ztztdata/rocketmq-all-4.1.0-incubating/store/commitlog</span></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#消费队列存储</span></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#storePathConsumeQueue=/home/ztztdata/rocketmq-all-4.1.0-incubating/store/consumequeue</span></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#消息索引存储路径</span></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#storePathIndex=/home/ztztdata/rocketmq-all-4.1.0-incubating/store/index</span></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#checkpoint 文件存储路径</span></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#storeCheckpoint=/home/ztztdata/rocketmq-all-4.1.0-incubating/store/checkpoint</span></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#abort 文件存储路径</span></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#abortFile=/home/ztztdata/rocketmq-all-4.1.0-incubating/store/abort</span></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#限制的消息大小</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">maxMessageSize</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #EEFFFF\">65536</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#flushCommitLogLeastPages=4</span></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#flushConsumeQueueLeastPages=2</span></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#flushCommitLogThoroughInterval=10000</span></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#flushConsumeQueueThoroughInterval=60000</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#Broker 的角色</span></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#- ASYNC_MASTER 异步复制Master</span></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#- SYNC_MASTER 同步双写Master</span></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#- SLAVE</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">brokerRole</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #EEFFFF\">ASYNC_MASTER</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#刷盘方式</span></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#- ASYNC_FLUSH 异步刷盘</span></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#- SYNC_FLUSH 同步刷盘</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">flushDiskType</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #EEFFFF\">ASYNC_FLUSH</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#发消息线程池数量</span></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#sendMessageThreadPoolNums=128</span></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#拉消息线程池数量</span></span>\n<span class=\"line\"><span style=\"color: #546E7A; font-style: italic\">#pullMessageThreadPoolNums=128</span></span></code></pre></div></p>\n</details>\n<p>我的 Broker 没有开启 ACL</p>\n<p>如果 Broker 开启了 ACL ，还要创建 <code>/Users/oak/docker/rocketmq/broker/conf/plain_acl.yml</code></p>\n<p>通过 Docker 启动的参数要加一行挂载命令</p>\n<div class=\"language-txt\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">txt</span><pre class=\"shiki material-theme\" style=\"background-color: #263238\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #EEFFFF\">-v /Users/oak/docker/rocketmq/broker/conf/plain_acl.yml:/home/rocketmq/rocketmq-4.9.6/conf/plain_acl.yml</span></span></code></pre></div><p>调用方服务的 ip 如果在 globalWhiteRemoteAddresses 白名单中，不会走 acl 鉴权</p>\n<div class=\"language-yaml\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">yaml</span><pre class=\"shiki material-theme\" style=\"background-color: #263238\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #F07178\">globalWhiteRemoteAddresses</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">-</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C3E88D\">10.10.103.*</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">-</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C3E88D\">172.168.1.*</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #F07178\">accounts</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">-</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #F07178\">accessKey</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C3E88D\">RocketMQ</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">  </span><span style=\"color: #F07178\">secretKey</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #F78C6C\">12345678</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">  </span><span style=\"color: #F07178\">whiteRemoteAddress</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">  </span><span style=\"color: #F07178\">admin</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #FF9CAC\">false</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">  </span><span style=\"color: #F07178\">defaultTopicPerm</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C3E88D\">DENY</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">  </span><span style=\"color: #F07178\">defaultGroupPerm</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C3E88D\">SUB</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">  </span><span style=\"color: #F07178\">topicPerms</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">  </span><span style=\"color: #89DDFF\">-</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C3E88D\">topicA=DENY</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">  </span><span style=\"color: #89DDFF\">-</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C3E88D\">topicB=PUB|SUB</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">  </span><span style=\"color: #89DDFF\">-</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C3E88D\">topicC=SUB</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">  </span><span style=\"color: #F07178\">groupPerms</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">  </span><span style=\"color: #546E7A; font-style: italic\"># the group should convert to retry topic</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">  </span><span style=\"color: #89DDFF\">-</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C3E88D\">groupA=DENY</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">  </span><span style=\"color: #89DDFF\">-</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C3E88D\">groupB=PUB|SUB</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">  </span><span style=\"color: #89DDFF\">-</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C3E88D\">groupC=SUB</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">-</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #F07178\">accessKey</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C3E88D\">rocketmq2</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">  </span><span style=\"color: #F07178\">secretKey</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #F78C6C\">12345678</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">  </span><span style=\"color: #F07178\">whiteRemoteAddress</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #C3E88D\">172.168.1.*</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">  </span><span style=\"color: #546E7A; font-style: italic\"># if it is admin, it could access all resources</span></span>\n<span class=\"line\"><span style=\"color: #EEFFFF\">  </span><span style=\"color: #F07178\">admin</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #EEFFFF\"> </span><span style=\"color: #FF9CAC\">true</span></span></code></pre></div>","feature":true,"text":"💡 全文聚焦 Docker 环境下 RocketMQ 单机部署，包含目录结构、配置模板和容器启动命令以及 RocketMQ Dashboard","permalink":"/post/Docker搭建RocketMQ","photos":[],"count_time":{"symbolsCount":"5.5k","symbolsTime":"5 mins."},"categories":[{"name":"Docker","slug":"Docker","count":6,"path":"api/categories/Docker.json"},{"name":"RocketMQ","slug":"Docker/RocketMQ","count":1,"path":"api/categories/Docker/RocketMQ.json"}],"tags":[{"name":"Docker","slug":"Docker","count":6,"path":"api/tags/Docker.json"},{"name":"RocketMQ","slug":"RocketMQ","count":1,"path":"api/tags/RocketMQ.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%95%9C%E5%83%8F%E6%8B%89%E5%8F%96\"><span class=\"toc-text\">镜像拉取</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%88%9B%E5%BB%BA%E5%AE%B9%E5%99%A8%E5%85%B1%E4%BA%AB%E7%BD%91%E7%BB%9C\"><span class=\"toc-text\">创建容器共享网络</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%90%AF%E5%8A%A8-NameServer\"><span class=\"toc-text\">启动 NameServer</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%90%AF%E5%8A%A8-Broker\"><span class=\"toc-text\">启动 Broker</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%90%AF%E5%8A%A8-Dashboard\"><span class=\"toc-text\">启动 Dashboard</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Broker-%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3\"><span class=\"toc-text\">Broker 配置详解</span></a></li></ol>","author":{"name":"GlassCat","slug":"blog-author","avatar":"/img/avatar.png","link":"/","description":"《论语·为政》<br/>吾尝终日不食，终夜不寝，以思无益，不如学也<br/>--孔子--","socials":{"github":"https://github.com/sunknightzy","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"https://www.zhihu.com/people/someaware","csdn":"","juejin":"","customs":{"mail":{"icon":"/svg/mail.svg","link":"mailto:593739859@qq.com"}}}},"mapped":true,"hidden":false,"prev_post":{"title":"JetBrains全家桶体验方案","uid":"0cfdc023c234c1bc698e1aac4bca057c","slug":"JetBrains全家桶体验方案","date":"2022-03-31T05:36:42.000Z","updated":"2025-05-15T02:16:12.000Z","comments":true,"path":"api/articles/JetBrains全家桶体验方案.json","keywords":null,"cover":"https://raw.githubusercontent.com/sunknightzy/picsee/main/Picsee/abnerworks.Typora/coverghojsR-IxZwOa.png","text":"这篇文章详细介绍了如何通过 JetBrains Toolbox 和 Agent 工具在电脑上安装和配置 JetBrains 全家桶开发环境的步骤，包括自动设置环境变量、修改 IDE 启动参数以及激活方法...","permalink":"/post/JetBrains全家桶体验方案","photos":[],"count_time":{"symbolsCount":"3.4k","symbolsTime":"3 mins."},"categories":[{"name":"MacBook","slug":"MacBook","count":3,"path":"api/categories/MacBook.json"},{"name":"环境搭建","slug":"MacBook/环境搭建","count":3,"path":"api/categories/MacBook/环境搭建.json"}],"tags":[{"name":"JetBrains","slug":"JetBrains","count":1,"path":"api/tags/JetBrains.json"},{"name":"IDE","slug":"IDE","count":1,"path":"api/tags/IDE.json"},{"name":"MacBook","slug":"MacBook","count":3,"path":"api/tags/MacBook.json"},{"name":"环境搭建","slug":"环境搭建","count":3,"path":"api/tags/环境搭建.json"}],"author":{"name":"GlassCat","slug":"blog-author","avatar":"/img/avatar.png","link":"/","description":"《论语·为政》<br/>吾尝终日不食，终夜不寝，以思无益，不如学也<br/>--孔子--","socials":{"github":"https://github.com/sunknightzy","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"https://www.zhihu.com/people/someaware","csdn":"","juejin":"","customs":{"mail":{"icon":"/svg/mail.svg","link":"mailto:593739859@qq.com"}}}},"feature":true},"next_post":{"title":"ES-05 Elasticsearch定制分词器","uid":"132a6bcb91ad26ef458d1f48fbda5347","slug":"ES-05-ElasticSearch定制分词器","date":"2018-09-15T06:26:09.000Z","updated":"2018-09-15T06:36:09.000Z","comments":true,"path":"api/articles/ES-05-ElasticSearch定制分词器.json","keywords":null,"cover":"https://raw.githubusercontent.com/sunknightzy/picsee/main/Picsee/abnerworks.Typora/blog-thumbnail-generic-release-CWWcnq.png","text":"文章介绍了ElasticSearch分析器的组成，展示了如何修改分词器、定制分词器...","permalink":"/post/ES-05-ElasticSearch定制分词器","photos":[],"count_time":{"symbolsCount":"7.9k","symbolsTime":"7 mins."},"categories":[{"name":"ElasticSearch系列","slug":"ElasticSearch系列","count":5,"path":"api/categories/ElasticSearch系列.json"}],"tags":[{"name":"ElasticSearch","slug":"ElasticSearch","count":6,"path":"api/tags/ElasticSearch.json"}],"author":{"name":"GlassCat","slug":"blog-author","avatar":"/img/avatar.png","link":"/","description":"《论语·为政》<br/>吾尝终日不食，终夜不寝，以思无益，不如学也<br/>--孔子--","socials":{"github":"https://github.com/sunknightzy","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"https://www.zhihu.com/people/someaware","csdn":"","juejin":"","customs":{"mail":{"icon":"/svg/mail.svg","link":"mailto:593739859@qq.com"}}}},"feature":true}}